{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Add TOML config file support",
        "status": "done",
        "priority": "high",
        "dependencies": [],
        "subtasks": [
          { "id": 1, "title": "Add toml + dirs crate dependencies", "status": "done" },
          { "id": 2, "title": "Create config module (src/config.rs)", "status": "done" },
          { "id": 3, "title": "Add file permission checks", "status": "done" },
          { "id": 4, "title": "Integrate config into CLI resolution", "status": "done" },
          { "id": 5, "title": "Auto-set 0600 permissions on config creation", "status": "deferred" },
          { "id": 6, "title": "Add tests for config loading and precedence", "status": "done" },
          { "id": 7, "title": "Update help text to mention config file", "status": "done" }
        ]
      },
      {
        "id": 2,
        "title": "Add optional OS keychain support",
        "status": "done",
        "priority": "medium",
        "dependencies": [1],
        "subtasks": [
          { "id": 1, "title": "Add keyring dependency with feature flag", "status": "done" },
          { "id": 2, "title": "Implement keychain get/set helpers", "status": "done" },
          { "id": 3, "title": "Integrate keychain into CLI resolution", "status": "done" },
          { "id": 4, "title": "Add tests for keychain integration", "status": "deferred", "description": "Keychain tests require OS interaction; covered by stub/compile tests for now." }
        ]
      },
      {
        "id": 3,
        "title": "Measure binary size impact",
        "status": "done",
        "priority": "high",
        "dependencies": [],
        "subtasks": [
          { "id": 1, "title": "Record baseline release binary size", "description": "1,334,496 bytes", "status": "done" },
          { "id": 2, "title": "Measure size after config file support", "description": "1,450,976 bytes (+116,480 / +8.7%)", "status": "done" },
          { "id": 3, "title": "Measure size after keychain support", "description": "1,452,208 bytes (+1,232 / +0.08% over config-only)", "status": "done" },
          { "id": 4, "title": "Report size comparison", "status": "done" }
        ]
      },
      {
        "id": 4,
        "title": "macOS code signing and notarization",
        "description": "Sign and notarize the macOS binary using an Apple Developer ID so users don't get Gatekeeper warnings. JD has an existing Apple Developer account.",
        "status": "pending",
        "priority": "high",
        "dependencies": [],
        "subtasks": [
          {
            "id": 1,
            "title": "Build macOS binaries (universal + arch-specific)",
            "description": "Build aarch64-apple-darwin and x86_64-apple-darwin separately, then combine with `lipo` into a universal binary (~2.8 MB). Add `make universal` target. Publish all three: universal (for Homebrew/default download), plus arch-specific for power users who want the smallest binary (~1.4 MB each).",
            "status": "pending"
          },
          {
            "id": 2,
            "title": "Code sign with Developer ID Application certificate",
            "description": "Sign the binary with `codesign --sign 'Developer ID Application: ...' --options runtime --timestamp`. The `--options runtime` flag enables hardened runtime (required for notarization). Requires the cert in Keychain.",
            "status": "pending"
          },
          {
            "id": 3,
            "title": "Notarize with Apple via notarytool",
            "description": "Submit the signed binary to Apple for notarization: `xcrun notarytool submit secrt.zip --apple-id <email> --team-id <team> --password <app-specific-password> --wait`. Requires an app-specific password from appleid.apple.com.",
            "status": "pending"
          },
          {
            "id": 4,
            "title": "Staple the notarization ticket",
            "description": "After notarization succeeds, staple the ticket: `xcrun stapler staple secrt`. This embeds the notarization so it works offline. Note: stapling only works on .app/.pkg/.dmg — for standalone binaries, macOS checks the ticket online. Consider distributing as .pkg or .dmg if offline verification matters.",
            "status": "pending"
          },
          {
            "id": 5,
            "title": "Add GitHub Actions CI workflow for macOS signing",
            "description": "Automate signing + notarization in CI. Store Developer ID cert as base64 in GitHub secrets. Use a keychain in the runner. Steps: import cert -> build universal -> codesign -> zip -> notarytool submit -> upload artifact.",
            "status": "pending"
          }
        ]
      },
      {
        "id": 5,
        "title": "Windows code signing with SSL.com certificate",
        "description": "Sign the Windows .exe with JD's SSL.com EV or OV code signing certificate. SSL.com uses their eSigner cloud signing service for EV certs (no USB token required in CI).",
        "status": "pending",
        "priority": "high",
        "dependencies": [],
        "subtasks": [
          {
            "id": 1,
            "title": "Cross-compile Windows binary",
            "description": "Build for x86_64-pc-windows-msvc (or -gnu). May need a Windows runner in CI or cross-compilation toolchain. Test that the binary works on Windows.",
            "status": "pending"
          },
          {
            "id": 2,
            "title": "Sign with SSL.com eSigner",
            "description": "Use SSL.com's eSigner for cloud-based signing. For CI: use the CodeSignTool CLI (`CodeSignTool sign -input_file_path=secrt.exe -username=<user> -password=<pass> -totp_secret=<secret> -credential_id=<id>`). Store credentials in GitHub secrets.",
            "status": "pending"
          },
          {
            "id": 3,
            "title": "Verify Authenticode signature",
            "description": "Verify the signed .exe using `signtool verify /pa secrt.exe` or PowerShell `Get-AuthenticodeSignature`. Confirm SmartScreen won't block it.",
            "status": "pending"
          },
          {
            "id": 4,
            "title": "Add GitHub Actions CI workflow for Windows signing",
            "description": "Add a Windows job to the release workflow. Steps: build on windows-latest -> sign with eSigner -> upload artifact. Store SSL.com credentials (username, password, TOTP secret, credential ID) in GitHub secrets.",
            "status": "pending"
          }
        ]
      },
      {
        "id": 6,
        "title": "Linux and cross-platform distribution",
        "description": "Linux binaries don't need code signing per se, but proper distribution channels need their own packaging and trust mechanisms.",
        "status": "pending",
        "priority": "medium",
        "dependencies": [],
        "subtasks": [
          {
            "id": 1,
            "title": "Build static Linux binaries (musl)",
            "description": "Build with `x86_64-unknown-linux-musl` and `aarch64-unknown-linux-musl` targets for portable static binaries. No glibc dependency = runs on any Linux distro.",
            "status": "pending"
          },
          {
            "id": 2,
            "title": "Generate SHA-256 checksums and GPG signatures",
            "description": "For every release artifact, generate SHA-256 checksums file and GPG-sign it. Users verify with `sha256sum -c checksums.txt` and `gpg --verify checksums.txt.asc`. Create or use a GPG key for the project.",
            "status": "pending"
          },
          {
            "id": 3,
            "title": "Create Homebrew tap",
            "description": "Create a `homebrew-tap` repo (e.g., getsecrt/homebrew-secrt) with a formula that downloads the macOS universal binary. Users install with `brew install getsecrt/secrt/secrt`. Formula auto-updates via release URLs with SHA-256 verification.",
            "status": "pending"
          },
          {
            "id": 4,
            "title": "Publish to crates.io",
            "description": "Publish to crates.io so Rust users can `cargo install secrt`. Clean up Cargo.toml metadata (description, license, keywords, categories). Crates.io handles integrity verification via its own checksums.",
            "status": "pending"
          },
          {
            "id": 5,
            "title": "Evaluate APT/RPM/AUR packaging",
            "description": "Determine whether to publish to Linux package repos. APT repo needs GPG-signed Release files. RPM needs GPG-signed packages. AUR (Arch) is community-maintained, low overhead. Consider starting with AUR + direct download and expanding later based on demand.",
            "status": "pending"
          }
        ]
      },
      {
        "id": 7,
        "title": "GitHub Actions release workflow",
        "description": "Unified CI workflow that builds, signs, and publishes releases for all platforms on git tag push.",
        "status": "pending",
        "priority": "high",
        "dependencies": [4, 5, 6],
        "subtasks": [
          {
            "id": 1,
            "title": "Define stable artifact naming convention",
            "description": "Use version-free filenames so `/releases/latest/download/` URLs are permanent: secrt-macos-universal, secrt-macos-arm64, secrt-macos-x86_64, secrt-linux-x86_64, secrt-linux-aarch64, secrt-windows-x86_64.exe. Version info lives in the GitHub Release tag/title, not the filename.",
            "status": "pending"
          },
          {
            "id": 2,
            "title": "Create release workflow triggered on version tags",
            "description": "Trigger on `v*` tags. Matrix build: macOS (universal + arch-specific), Windows (x86_64), Linux (x86_64-musl, aarch64-musl). Each job builds, signs (platform-specific), and uploads artifacts using the stable naming convention.",
            "status": "pending"
          },
          {
            "id": 3,
            "title": "Auto-create GitHub Release with artifacts",
            "description": "After all build jobs complete, create a GitHub Release with all signed binaries, checksums file, and GPG signature. Use `gh release create` or softprops/action-gh-release.",
            "status": "pending"
          },
          {
            "id": 4,
            "title": "Add download links to README",
            "description": "Add an Install section with permanent latest-release download links using GitHub's `/releases/latest/download/` URL pattern. E.g. `https://github.com/getsecrt/secrt-cli/releases/latest/download/secrt-macos-universal`. Include links for macOS (universal), Linux (x86_64, aarch64), and Windows. These URLs never need updating because filenames are version-free.",
            "status": "pending"
          },
          {
            "id": 5,
            "title": "Update Homebrew formula on release",
            "description": "After GitHub Release is created, auto-update the Homebrew tap formula with new version, URL, and SHA-256. Can use a dispatch event or a separate workflow in the tap repo.",
            "status": "pending"
          },
          {
            "id": 6,
            "title": "Document release workflow in CLAUDE.md for agent automation",
            "description": "Add a Release section to CLAUDE.md (or AGENTS.md) that documents the full release process so AI agents can execute it: bump version in Cargo.toml, update CHANGELOG, create git tag (v*.*.*), push tag to trigger CI, verify CI artifacts, confirm GitHub Release is published, verify Homebrew formula updated. Include pre-flight checks (tests pass, clippy clean, no uncommitted changes), signing details (which secrets/certs are needed), and rollback steps. The goal is that an agent reading CLAUDE.md can cut a release end-to-end.",
            "status": "pending"
          }
        ]
      },
      {
        "id": 9,
        "title": "Redesign interactive secret input: single-line default, --multi-line, --trim",
        "description": "Redesign how `secrt create` reads secrets interactively (TTY mode). Currently uses read_pass for single-line input with no echo. This task formalizes the behavior with explicit flags and clear UX.\n\nDesign:\n| Flag | Behavior |\n|------|----------|\n| (none) | Single-line: password-style prompt (no echo), read until Enter, strip trailing newline |\n| --multi-line, -m | Multi-line: read until Ctrl+D, preserve exact bytes (no trimming) |\n| --trim | Modifier: explicitly trim leading/trailing whitespace (including \\r, \\n) |\n\nKey decisions:\n- Default (no flags) is optimized for the most common case: sharing passwords, API keys, tokens. Single-line, no echo, safe.\n- --multi-line is for power users who need to paste blocks of text (SSH keys, certs, config snippets). Preserves exact bytes — if user presses Ctrl+D on its own line, the trailing \\n is included. If they Ctrl+D immediately after text, no trailing \\n. User controls this.\n- --trim is an optional modifier, primarily useful with --multi-line. Strips leading/trailing whitespace including newlines. Rare use case but available.\n- No --raw flag needed — --multi-line is effectively raw.\n- Piped/redirected stdin (non-TTY) behavior is unchanged: read all bytes until EOF.\n- --text and --file flags are unaffected by this change.\n\nUX details:\n- Single-line prompt should say something like 'Enter secret (input hidden):' so users understand why nothing appears\n- Multi-line prompt: 'Enter secret (Ctrl+D on empty line to finish):' or similar\n- Consider showing byte count after input: 'Received N bytes' on stderr",
        "status": "pending",
        "priority": "medium",
        "dependencies": [],
        "subtasks": [
          {
            "id": 1,
            "title": "Add --multi-line (-m) and --trim flags to arg parser",
            "description": "Add multi_line: bool and trim: bool fields to ParsedArgs. Parse --multi-line / -m and --trim flags in parse_flags(). Update help text to document both flags. -t shorthand for --trim only if it doesn't conflict with --text (which uses --text, not -t, so -t should be safe).",
            "status": "pending"
          },
          {
            "id": 2,
            "title": "Refactor read_plaintext for single-line vs multi-line TTY input",
            "description": "In TTY mode:\n- Default (no --multi-line): use deps.read_pass to read single line without echo, strip trailing newline. Prompt: 'Enter secret (input hidden):'\n- With --multi-line: use deps.stdin.read_to_end to read until EOF (Ctrl+D). Prompt: 'Enter secret (Ctrl+D on empty line to finish):'. Show input (echo enabled) since multi-line users need to see what they're typing.\n\nNon-TTY mode: unchanged (read_to_end from stdin regardless of flags).",
            "status": "pending"
          },
          {
            "id": 3,
            "title": "Implement --trim flag behavior",
            "description": "When --trim is set, trim leading and trailing whitespace (including \\r, \\n, spaces, tabs) from the plaintext after reading. Apply after read_plaintext returns, before the empty check. Works with any input source (stdin, --text, --file, --multi-line). After trimming, if the result is empty, return the 'input is empty' error.",
            "status": "pending"
          },
          {
            "id": 4,
            "title": "Add tests for new flags and input modes",
            "description": "Tests to add:\n- Single-line TTY: verify read_pass is used, no echo, trailing newline stripped\n- --multi-line TTY: verify read_to_end is used, exact bytes preserved\n- --multi-line with trailing newline: verify newline is kept\n- --trim: verify whitespace stripped from all edges\n- --trim with --multi-line: verify both work together\n- --trim making input empty: verify error\n- Non-TTY: verify --multi-line has no effect (already reads all bytes)\n- Unknown flag errors still work\n- Help text includes new flags",
            "status": "pending"
          },
          {
            "id": 5,
            "title": "Update help text and documentation",
            "description": "Update create command help text to document --multi-line (-m) and --trim flags with clear descriptions. Update README if it documents the create command. Ensure the interactive prompts clearly communicate what's happening (e.g., 'input hidden' for single-line, 'Ctrl+D to finish' for multi-line).",
            "status": "pending"
          }
        ]
      },
      {
        "id": 10,
        "title": "Hash owner_key (IP address) for privacy",
        "description": "The backend stores raw IP addresses as owner_key in the secrets table for per-IP quota enforcement and burn authorization. This is at odds with the zero-knowledge design. Replace raw IPs with a keyed hash (e.g., HMAC-SHA256(ip, daily_rotating_secret)) so quotas still work but the DB never contains recoverable IP addresses. Considerations:\n- Burn authorization still works since the same IP produces the same hash within the rotation window\n- DB performance is unaffected: same indexed column, just matching on hash strings instead of IPs\n- Daily salt rotation means old records can't be correlated with new ones after rotation\n- Authenticated users (API key) can keep using 'apikey:' + prefix as-is since that's already non-PII\n- May want a migration to hash existing owner_key values in-place\n- Consider whether server logs also need IP scrubbing for consistency",
        "status": "pending",
        "priority": "high",
        "dependencies": [],
        "subtasks": [
          { "id": 1, "title": "Add HMAC-SHA256 helper with rotating daily secret", "status": "pending" },
          { "id": 2, "title": "Replace raw IP storage with hashed owner_key in Create handler", "status": "pending" },
          { "id": 3, "title": "Update clientIP/ownerKey resolution in Burn handler", "status": "pending" },
          { "id": 4, "title": "Write migration to hash existing owner_key values", "status": "pending" },
          { "id": 5, "title": "Add tests for hashed quota enforcement and burn auth", "status": "pending" },
          { "id": 6, "title": "Review server access logs for IP leakage", "status": "pending" }
        ]
      },
      {
        "id": 11,
        "title": "Investigate release binary size optimization",
        "description": "Explore options for reducing the release binary size (~1.45 MB currently). Two main approaches to evaluate, both with trade-offs:\n\n1. **UPX compression** — compresses the binary with runtime decompression. Can cut size significantly but may trigger false positives on antivirus/malware scanners (especially Windows Defender, VirusTotal). Test on macOS, Linux, and Windows. Measure decompression startup latency.\n\n2. **opt-level = \"z\" (optimize for size)** — compiler optimization level that prioritizes code size over speed. Can reduce binary substantially but roughly halves the speed of PBKDF2 passphrase derivation (CPU-bound crypto). Measure the actual impact on `--passphrase-*` operations. Consider whether a profile override for just the `ring` crate (opt-level = 3) could preserve crypto speed while shrinking everything else.\n\nOther options to consider:\n- `lto = true` (already may be set — check Cargo.toml [profile.release])\n- `codegen-units = 1` (better optimization, slower compile)\n- `strip = true` (strip debug symbols)\n- `panic = \"abort\"` (smaller than unwind, already may be set)\n- Auditing dependencies for lighter alternatives\n\nGoal: understand the trade-off space, not necessarily ship a change. Document findings in a comment or subtask.",
        "status": "pending",
        "priority": "low",
        "dependencies": [],
        "subtasks": [
          { "id": 1, "title": "Audit current Cargo.toml [profile.release] settings", "status": "pending" },
          { "id": 2, "title": "Test UPX compression — measure size reduction and check for AV false positives", "status": "pending" },
          { "id": 3, "title": "Test opt-level = \"z\" — measure size reduction and PBKDF2 speed impact", "status": "pending" },
          { "id": 4, "title": "Test per-crate opt-level override (ring at opt-level 3, rest at z)", "status": "pending" },
          { "id": 5, "title": "Document findings and recommendation", "status": "pending" }
        ]
      },
      {
        "id": 8,
        "title": "Add coverage exclusion annotations to untestable code",
        "description": "Rust's #[coverage(off)] attribute is still unstable (tracking issue rust-lang/rust#134749). Once stabilized on stable Rust, annotate the ~129 lines of genuinely untestable code (main.rs I/O wiring, ring crypto internal errors, unreachable branches) so cargo llvm-cov reports accurate achievable coverage. See docs/test-coverage.md 'Theoretical Coverage Ceiling' section for the full list.",
        "status": "pending",
        "priority": "low",
        "dependencies": [],
        "subtasks": []
      }
    ]
  }
}
